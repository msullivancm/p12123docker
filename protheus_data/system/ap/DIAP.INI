?{"Nome do Arquivo INI","DIAP.INI"}
?{"Descricao Completa do Arquivo Magnetico","DIAP - Declaracao de Informacoes e Apuracao do ICMS que integra todos os Regimes de Tributacao: Normal, Estimado, Simples e os detentores do Regime de Tributacao por Substituicao Tributaria."}
?{"A Quem se Destina","Todos os contribuintes inscritos no cadastro do ICMS do Estado do Amapa."}
?{"Objetivo","Validar e transferir as declaracoes de ICMS a Secretaria da Fazenda."}
?{"Prazo de Entrega","Ate o 5 dia uitl do mes subsequente"}
?{"Aplicativo Disponibilizado pelo Fisco","DIAP"}
?{"Versao do Aplicativo Contemplada pela Microsiga","3.00"}
?{"Comentarios",""}
[XXX 1-Registro Inicial]
(PRE) _aTotal[001] := MV_PAR01
(PRE) _aTotal[002] := MV_PAR02
(PRE) _aTotal[003] := {}
(PRE) _aTotal[004] := {}       
(PRE) _aTotal[005] := {}
(PRE) _aTotal[097] := {}
(PRE) _aTotal[098] := {}
(PRE) _aTotal[099] := .F.
(PRE) DIAP()

[XXX Montagem do CFP Utilizado pela rotina - PRINCIPAL]
(PRE) aAdd (_aTotal[003], "Processamento da DIAP-AP")
(PRE) aAdd (_aTotal[003], "")
(PRE) aAdd (_aTotal[003], "Preencha corretamente as informações solicitadas.")
(PRE) aAdd (_aTotal[003], "Informações necessárias para o preenchimento automático da DIAP-AP         Declaração de Informações e Apuração do ICMS do estado do Amapá.")

[XXX Montagem do CFP Utilizado pela rotina - COMPLEMENTAR]
(PRE) aAdd (_aTotal[004], {})
(PRE) aAdd (_aTotal[004][1], "Processamento da DIAP-AP")
(PRE) aAdd (_aTotal[004][1], "Informações necessárias para geração da DIAP-AP.")
(PRE) aAdd (_aTotal[004][1], {})
(PRE) aAdd (_aTotal[004][1][3], {1, "Motivo",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1, "Tipo da DIAP",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {3,,,,,{"1-Padrão", "2-Paralisação para Conclusão de baixa", "3Paralisação Temporária","4-Reativação de Atividades","5-Mudança de domicílio fiscal","6-Mudança de Regime"},,})
(PRE) aAdd (_aTotal[004][1][3], {3,,,,,{"1-Original"},,})
(PRE) aAdd (_aTotal[004][1][3], {1, "Periodicidade da DIAP",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {3,,,,,{"1-Mensal"},,})
(PRE) aAdd (_aTotal[004][1][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1, "Município  de Origem",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1, "Município  de Destino",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {3,,,,,{"601 - Amapa","603 - Calcoene","605 - Macapa","607 - Mazagao","609 - Oiapoque","610 - Vitoria Do Jari","611 - Ferreira Gomes","613 - Laranjal Do Jari","615 - Santana","617 - Tartarugalzinho","663 - Amapari","665 - Serra Do Navio","667 - Cutias Do Araguary","669 - Itaubal do Piririm","671 - Porto Grande","673 - Pracuuba","699 - Nenhum"},,})
(PRE) aAdd (_aTotal[004][1][3], {3,,,,,{"601 - Amapa","603 - Calcoene","605 - Macapa","607 - Mazagao","609 - Oiapoque","610 - Vitoria Do Jari","611 - Ferreira Gomes","613 - Laranjal Do Jari","615 - Santana","617 - Tartarugalzinho","663 - Amapari","665 - Serra Do Navio","667 - Cutias Do Araguary","669 - Itaubal do Piririm","671 - Porto Grande","673 - Pracuuba","699 - Nenhum"},,})
(PRE) aAdd (_aTotal[004][1][3], {1, "N. Funcionários Inicial",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1, "N. Funcionários Final",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {2,,"9999",1,,,,4})
(PRE) aAdd (_aTotal[004][1][3], {2,,"9999",1,,,,4})
(PRE) aAdd (_aTotal[004][1][3], {1, "Vl. Disponibilidade Caixa Inicial",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1, "Vl. Disponibilidade Caixa Final",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][1][3], {2,,"@E 99,999,999.99",2,2,,,13})  
(PRE) aAdd (_aTotal[004][1][3], {1, "Houve Movimentacao de Entrada/Saida?",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1, "Houve Redução de Base de Calculo?",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {3,,,,,{"1-Sim", "2-Não"},,})
(PRE) aAdd (_aTotal[004][1][3], {3,,,,,{"1-Sim", "2-Não"},,})              
(PRE) aAdd (_aTotal[004][1][3], {1, "Houve Operacoes Interestaduais?",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {1, "Existe Estoque ?",,,,,,})
(PRE) aAdd (_aTotal[004][1][3], {3,,,,,{"1-Sim", "2-Não"},,})
(PRE) aAdd (_aTotal[004][1][3], {3,,,,,{"1-Sim", "2-Não"},,})

[XXX Montagem do CFP Utilizado pela rotina - COMPLEMENTAR]
(PRE) aAdd (_aTotal[004], {})
(PRE) aAdd (_aTotal[004][2], "Processamento da DIAP-AP")
(PRE) aAdd (_aTotal[004][2], "Registro de Detalhamento do ICMS ")
(PRE) aAdd (_aTotal[004][2], {})
(PRE) aAdd (_aTotal[004][2][3], {1, "COLUNA NORMAL/ESTIMATIVA/SIMPLES",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido ou a recolher no prazo legal",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido fora do prazo",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. Vencido e não recolhido",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr Estimativas pagas no período",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {1, "Valor Total a Recolher/Estimativa",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Valor Total a Recolher/Simples",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})  
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "COLUNA IMPORTAÇÃO",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})  
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido ou a recolher no prazo legal",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido fora do prazo",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. Vencido e não recolhido",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Valor Benefício Fiscal",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13}) 
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})  
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "COLUNA DIF. ALIQUOTA IMOBILIZADO",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido ou a recolher no prazo legal",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido fora do prazo",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. Vencido e não recolhido",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Valor Benefício Fiscal",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})  
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})  
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "COLUNA DIF ALIQ. MAT. DE CONSUMO",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido ou a recolher no prazo legal",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido fora do prazo",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. Vencido e não recolhido",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})                     
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})  
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "COLUNA ICMS SUBST. TRIBUTÁRIA",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {0, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido ou a recolher no prazo legal",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. recolhido fora do prazo",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})
(PRE) aAdd (_aTotal[004][2][3], {1, "Vlr. Vencido e não recolhido",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {1, "",,,,,,})
(PRE) aAdd (_aTotal[004][2][3], {2,,"@E 99,999,999.99",2,2,,,13})

[XXX Chamada do Wizard]
(PRE) _aTotal[099] := xMagWizard (_aTotal[003], _aTotal[004], "DIAP")
(PRE) Iif (_aTotal[099], xMagLeWiz ("DIAP",@_aTotal[098], .T.), Nil)
(PRE) lAbtMT950	:= !_aTotal[099]  
  
[XXX 2-Registro principal da DIAP-AP]
(DEL) ; MF   
(PRE) RET->(DbGoTop()) 
(PRE) RBN->(DbGoTop())
TPREG      C 006 0 "DIAPPR"
NRINSCEST  C 011 0 TRANSFORM(SM0->M0_INSC,"@R 99.999999-9")
MOTIVO     C 002 0 StrZero(VAl(Substr(_aTotal[098][1][1],1,1)),2)
SEQGERAL   C 005 0 "00001" 
SEQPARC    C 003 0 "001"
TIPO       C 002 0 StrZero(Val(Substr(_aTotal[098][1][2],1,1)),2)
PERIODICI  C 002 0 StrZero(Val(Substr(_aTotal[098][1][3],1,1)),2)   
PERINIC    C 008 0 DToS(_aTotal[001])
PERFIM     C 008 0 DToS(_aTotal[002])
MUNORIG    C 006 0 StrZero(Val(Substr(_aTotal[098][1][4],1,3)),6)
MUNDEST    C 006 0 StrZero(Val(Substr(_aTotal[098][1][5],1,3)),6)
FUNCINIC   C 004 0 StrZero(Val(_aTotal[098][1][6]),4)
FUNCFIM    C 004 0 StrZero(Val(_aTotal[098][1][7]),4)
CAIXAINIC  C 015 0 StrTran(_aTotal[098][1][8],".","")
CAIXAFIM   C 015 0 StrTran(_aTotal[098][1][9],".","")
MOVIMENTAC C 001 0 Iif(Substr(_aTotal[098][1][10],1,1)="1","S","N")
REDUCAO    C 001 0 Iif(Substr(_aTotal[098][1][11],1,1)="1","S","N")
INTERESTAD C 001 0 Iif(Substr(_aTotal[098][1][12],1,1)="1","S","N")
ESTIMPTRIB C 015 2 StrTran(StrZero(RET->ESTMPIT,16,2),".","")
ESTIMPISEN C 015 2 StrTran(StrZero(RET->ESTMPII,16,2),".","")
ESTIMPOUTR C 015 2 StrTran(StrZero(RET->ESTMPIO,16,2),".","")
ESTIRVTRIB C 015 2 StrTran(StrZero(RET->ESTMEIT,16,2),".","")
ESTIRVISEN C 015 2 StrTran(StrZero(RET->ESTMEII,16,2),".","")
ESTIRVOUTR C 015 2 StrTran(StrZero(RET->ESTMEIO,16,2),".","")
ESTIPATRIB C 015 2 StrTran(StrZero(RET->ESTMPAIT,16,2),".","")
ESTIPAISEN C 015 2 StrTran(StrZero(RET->ESTMPAII,16,2),".","")
ESTIPAOUTR C 015 2 StrTran(StrZero(RET->ESTMPAIO,16,2),".","")
ESTIPAETRB C 015 2 StrZero(0,15)
ESTIPAEISN C 015 2 StrZero(0,15)
ESTIPAEOTR C 015 2 StrZero(0,15)
ESTIUSOOTR C 015 2 StrTran(StrZero(RET->ESTMMCIO,16,2),".","")
ESTIATVOTR C 015 2 StrTran(StrZero(RET->ESTMATIO,16,2),".","")
ESTI3OUTR  C 015 2 StrTran(StrZero(RET->ESTTEIO,16,2),".","")
ESTFMPTRIB C 015 2 StrTran(StrZero(RET->ESTMPFT,16,2),".","")
ESTFMPISEN C 015 2 StrTran(StrZero(RET->ESTMPFI,16,2),".","")
ESTFMPOUTR C 015 2 StrTran(StrZero(RET->ESTMPFO,16,2),".","")
ESTFRVTRIB C 015 2 StrTran(StrZero(RET->ESTMEFT,16,2),".","")
ESTFRVISEN C 015 2 StrTran(StrZero(RET->ESTMEFI,16,2),".","")
ESTFRVOUTR C 015 2 StrTran(StrZero(RET->ESTMEFO,16,2),".","")
ESTFPATRIB C 015 2 StrTran(StrZero(RET->ESTMPAFT,16,2),".","")
ESTFPAISEN C 015 2 StrTran(StrZero(RET->ESTMPAFI,16,2),".","")
ESTFPAOUTR C 015 2 StrTran(StrZero(RET->ESTMPAFO,16,2),".","")
ESTFPAETRB C 015 2 StrZero(0,15)
ESTFPAEISN C 015 2 StrZero(0,15)
ESTFPAEOTR C 015 2 StrZero(0,15) 
ESTFUSOOTR C 015 2 StrTran(StrZero(RET->ESTMMCFO,16,2),".","")
ESTFATVOTR C 015 2 StrTran(StrZero(RET->ESTMATFO,16,2),".","")
ESTF3OUTR  C 015 2 StrTran(StrZero(RET->ESTTEFO,16,2),".","")
DEBSAIDA   C 015 2 StrTran(StrZero(RAP->DebSaid,16,2),".","")
OUTRDEB    C 015 2 StrTran(StrZero(RAP->OutDeb,16,2),".","")
ESTCRED    C 015 2 StrTran(StrZero(RAP->EstCred,16,2),".","")
CREDENTR   C 015 2 StrTran(StrZero(RAP->CredEntr,16,2),".","")
OUTRCRED   C 015 2 StrTran(StrZero(RAP->OutCred,16,2),".","")
ESTDEB     C 015 2 StrTran(StrZero(RAP->EstDeb,16,2),".","")
CREDANT    C 015 2 StrTran(StrZero(RAP->SdCdAnt,16,2),".","")
PRAZONOR   C 015 2 StrTran(_aTotal[098][2][01],".","")
PRAZOIMP   C 015 2 StrTran(_aTotal[098][2][07],".","")
PRAZOIMOB  C 015 2 StrTran(_aTotal[098][2][11],".","")
FPRAZONOR  C 015 2 StrTran(_aTotal[098][2][02],".","")
FPRAZOIMP  C 015 2 StrTran(_aTotal[098][2][08],".","")
FPRAZOIMOB C 015 2 StrTran(_aTotal[098][2][12],".","")
VENCNOR    C 015 2 StrTran(_aTotal[098][2][03],".","")
VENCIMP    C 015 2 StrTran(_aTotal[098][2][09],".","")
VENCIMOB   C 015 2 StrTran(_aTotal[098][2][13],".","")
BEFINOR    C 015 2 StrTran(StrZero(RBN->VALOR,16,2),".","")
BEFIIMP    C 015 2 StrTran(_aTotal[098][2][10],".","")
BEFIIMOB   C 015 2 StrTran(_aTotal[098][2][14],".","")
ESTPGNOR   C 015 2 StrTran(_aTotal[098][2][04],".","")
ESTIMNOR   C 015 2 StrTran(_aTotal[098][2][05],".","")
CAMPOVAGO  C 015 2 StrZero(0,15)
NORMANOR   C 015 2 StrTran(StrZero(RAP->ImpRec,16,2),".","")
SIMPLNOR   C 015 2 StrTran(_aTotal[098][2][06],".","")
PRAZOUSO   C 015 2 StrTran(_aTotal[098][2][15],".","")
PRAZOST    C 015 2 StrTran(_aTotal[098][2][18],".","")
FPRAZOUSO  C 015 2 StrTran(_aTotal[098][2][16],".","")
FPRAZOST   C 015 2 StrTran(_aTotal[098][2][19],".","")
VENCUSO    C 015 2 StrTran(_aTotal[098][2][17],".","")
VENCST     C 015 2 StrTran(_aTotal[098][2][20],".","")
VLREST     C 015 2 StrZero(0,15)
IPIEST     C 015 2 StrZero(0,15)
DESPEST    C 015 2 StrZero(0,15)
BASPROPEST C 015 2 StrZero(0,15)
PROPREST   C 015 2 StrZero(0,15)
BASESTEST  C 015 2 StrZero(0,15)
ICMSTEST   C 015 2 StrZero(0,15)
DEVOLEST   C 015 2 StrZero(0,15)
RESARCEST  C 015 2 StrZero(0,15)
CREDANTER  C 015 2 StrZero(0,15)
CREDSEG    C 015 2 StrZero(0,15)
STRECOLHER C 015 2 StrZero(0,15)
PRODRETENT C 015 2 StrZero(0,15)
IPIRETENTR C 015 2 StrZero(0,15)
DESPRETENT C 015 2 StrZero(0,15)
BASRETENTR C 015 2 StrZero(0,15)
RETENTR    C 015 2 StrZero(0,15)
BASSTENTR  C 015 2 StrZero(0,15)
STRETENTR  C 015 2 StrZero(0,15)
PRODFONTE  C 015 2 StrZero(0,15)
IPIFONTE   C 015 2 StrZero(0,15)
DESPFONTE  C 015 2 StrZero(0,15)
BASPROPFON C 015 2 StrZero(0,15)
ICMFONTE   C 015 2 StrZero(0,15)
BASSTFONTE C 015 2 StrZero(0,15)
STFONTE    C 015 2 StrZero(0,15)
CREDORFIM  C 015 2 StrTran(StrZero(RAP->SdCred,16,2),".","")
DEVEDORFIM C 015 2 StrTran(StrZero(RAP->SdDev,16,2),".","")
BASSIMPLES C 015 2 StrZero(0,15)
SIMPLESREC C 015 2 StrZero(0,15)
IMPFOB     C 015 2 StrZero(0,15)
FRETEFOB   C 015 2 StrZero(0,15)
SEGFOB     C 015 2 StrZero(0,15)
FEDFOB     C 015 2 StrZero(0,15)
ADUANFOB   C 015 2 StrZero(0,15)
OUTDESPFOB C 015 2 StrZero(0,15)
BASIMPFOB  C 015 2 StrZero(0,15)
ICMIMPORT  C 015 2 StrZero(0,15)
IMPCIF     C 015 2 StrZero(0,15)
DESPFRECIF C 015 2 StrZero(0,15)
SEGURCIF   C 015 2 StrZero(0,15)
FEDERCIF   C 015 2 StrZero(0,15)
ADUANCIF   C 015 2 StrZero(0,15)
OUTASCIF   C 015 2 StrZero(0,15)
AGREGCIF   C 015 2 StrZero(0,15)
BASIMPCIF  C 015 2 StrZero(0,15)
ANTIMPCIF  C 015 2 StrZero(0,15)
ANTIMPRCIF C 015 2 StrZero(0,15)
DTGERA     C 008 0 Dtos(dDataBase)
HRGERA     C 008 0 TIME()
FORMACAD   C 001 0 "I"         
EXESTOQUE  C 001 0 Iif(Substr(_aTotal[098][1][13],1,1)="1","S","N")
JUSTODEB   C 900 0 Iif(RAP->OutDeb>0,RAP->DOutDeb,"")
JESTCRED   C 900 0 Iif(RAP->EstCred>0,RAP->DEstCred,"")
JESTDEB    C 900 0 Iif(RAP->EstDeb>0,RAP->DEstDeb,"")
 
(POS) ResumeF3("IC",MV_PAR01,MV_PAR02,"*",.F.,.T.,1,.F.,2,Nil,Nil,{},{},"",.T.,"ICU",,,,,,,,.T.)

[ICU 3-Registro de Entradas DIAP-AP] 
(DEL) ; MF 
(PRE) ICU->(DbGoTop()) 
(PREREG) !("3"$_aTotal[098][1][3])
(PREREG) ("1"$_aTotal[098][1][10])   
(PREREG) Subs(ICU->CFOP,1,1)<"5" 
TPREG      C 006 0 "DIAPEN"
CFOP       C 005 0 TRANSFORM(ICU->CFOP,"@R 9.9999")
UFENTR     C 002 0 ICU->UF
VLCONT     C 015 2 StrTran(StrZero(ICU->VALCONT,16,2),".","")
BASECALC   C 015 2 StrTran(StrZero(ICU->BASEICM,16,2),".","")
IMPCRED    C 015 2 StrTran(StrZero(ICU->VALICM,16,2),".","")
VLISENT    C 015 2 StrTran(StrZero(ICU->ISENICM,16,2),".","")
VLOUTR     C 015 2 StrTran(StrZero(ICU->OUTRICM,16,2),".","")
VLIPI      C 015 2 StrTran(StrZero(ICU->VALIPI,16,2),".","")
VLRETIDO   C 015 2 StrTran(StrZero(ICU->ICMSRET,16,2),".","")

[ICU 3-Registro de Saidas DIAP-AP]  
(DEL) ; MF 
(PRE) ICU->(DbGoTop())
(PREREG) !("3"$_aTotal[098][1][3])     
(PREREG) ("1"$_aTotal[098][1][10])
(PREREG) Subs(ICU->CFOP,1,1)>="5"
TPREG      C 006 0 "DIAPSA"
CFOP       C 005 0 TRANSFORM(ICU->CFOP,"@R 9.9999")
UFENTR     C 002 0 ICU->UF
VLCONT     C 015 2 StrTran(StrZero(ICU->VALCONT,16,2),".","")
BASECALC   C 015 2 StrTran(StrZero(ICU->BASEICM,16,2),".","")
IMPCRED    C 015 2 StrTran(StrZero(ICU->VALICM,16,2),".","")
VLISENT    C 015 2 StrTran(StrZero(ICU->ISENICM,16,2),".","")
VLOUTR     C 015 2 StrTran(StrZero(ICU->OUTRICM,16,2),".","")
VLIPI      C 015 2 StrTran(StrZero(ICU->VALIPI,16,2),".","")
VLRETIDO   C 015 2 StrTran(StrZero(ICU->ICMSRET,16,2),".","")

[ROC 4-Registro de Outros Créditos DIAP-AP]  
(DEL) ; MF                        
(PRE) ROC->(DbGoTop())
TPREG      C 006 0 "DIAPOC"
CODIGO     C 003 0 ROC->CODIGO
VLOUTROS   C 015 2 StrTran(StrZero(ROC->VALOR,16,2),".","")

[RBN 5-Registro de Benefício Fiscal-AP]  
(DEL) ; MF    
(PRE) RBN->(DbGoTop())
TPREG      C 006 0 "DIAPBF"
CODIGO     C 003 0 RBN->CODIGO
VLBENEF    C 015 2 StrTran(StrZero(RBN->VALOR,16,2),".","")
(POS) ResumeF3("IC",MV_PAR01,MV_PAR02,"*",.F.,.T.,1,.F.,2,Nil,Nil,{},{},"",.T.,"ICM",.T.,,)

[ICM 8-Registro de Entradas UF DIAP-AP]
(DEL) ; MF         
(PRE) ICM->(DbGoTop())  
(PREREG) ("3"$_aTotal[098][1][3]) 
(PREREG) Subs(ICM->CFOP,1,1)<"5"
TPREG      C 006 0 "DIAPUE"
UFSIGLA    C 002 0 ICM->UF
VLCONTAB   C 015 2 StrTran(StrZero(ICM->VALCONT,16,2),".","")
BASECALC   C 015 2 StrTran(StrZero(ICM->BASEICM,16,2),".","")
VLOUTR     C 015 2 StrTran(StrZero(ICM->OUTRICM,16,2),".","")
VLDEMAIS   C 015 2 StrZero(0,15)
PETRENERG  C 015 2 StrZero(0,15)
OUTRPROD   C 015 2 StrZero(0,15)       

[ICM 8-Registro de Saídas UF DIAP-AP]
(DEL) ; MF              
(PRE) ICM->(DbGoTop())  
(PREREG) ("3"$_aTotal[098][1][3]) 
(PREREG) Subs(ICM->CFOP,1,1)>="5"
TPREG      C 006 0 "DIAPUS"
UFSIGLA    C 002 0 ICM->UF
VLCONTC    C 015 2 StrTran(StrZero(ICM->VALCONC,16,2),".","")
VLCONTNC   C 015 2 StrTran(StrZero(ICM->VALCONNC,16,2),".","")
BASECONTR  C 015 2 StrTran(StrZero(ICM->BASEICC,16,2),".","")
BASENCONTR C 015 2 StrTran(StrZero(ICM->BASEICNC,16,2),".","")
VLOUTR     C 015 2 StrTran(StrZero(ICM->OUTRICM,16,2),".","")
VLDEMAIS   C 015 2 StrZero(0,15)  
VALORST    C 015 2 StrTran(StrZero(ICM->ICMSRET,16,2),".","")

[RRI 7-Registro de Isenções DIAP-AP] 
(PREREG) ("1"$_aTotal[098][1][10]) 
(DEL) ; MF 
(PRE) RRI->(DbGoTop())  
TPREG      C 006 0 "DIAPIS"
CODISE     C 003 0 RRI->CODIGO
VALOR      C 015 2 StrTran(StrZero(RRI->VALOR,16,2),".","")
(POS)
